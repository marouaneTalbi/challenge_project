{% extends 'base_front.html.twig' %}

{% block body %}

    <table class="table">
        <tbody>
            <tr>
                <th>Id</th>
                <td>{{ music_group.id }}</td>
            </tr>
            <tr>
                <th>Name</th>
                <td>{{ music_group.name }}</td>
            </tr>
            <tr>
                <th>Music list</th>

                <td>
                    <ul>
                        {% for music in musics %}
                            <li>{{ music.name }}</li>
                        {% endfor %}
                    </ul>
                </td>
            </tr>
            <tr>
                <th>Artist</th>
                <th>
                    {% for artist in artists %}
                        <li>{{ artist.firstname }}</li>
                    {% endfor %}
                </th>
            </tr>

        </tbody>
    </table>

    <div id="div1"
         style="
            height: 200px;
            width:30%;
            display: flex;
            justify-content: center;
            align-items: center;
            ">

    </div>

    <div id="div2"
         style="
            height: 200px;
            width:30%;
            display: flex;
            flex-direction: column;
            margin-bottom:5%;
    ">

    </div>

    {% set array = [] %}
    {% for music in musics %}
         {% set array = array | merge([{id: music.id ,name: music.name, url: music.url}]) %}
    {% endfor %}
    <input type="hidden" id="array" value="{{ array|json_encode }}">

    <audio controls id="audio"></audio>

    <script>
        const musics = document.getElementById('array').value;
        const allMusicsParsed = JSON.parse(musics);
        const audio = document.getElementById("audio");
        const source= document.createElement("source");
        const previus = document.createElement("button");
        const next = document.createElement("button");
        const songName= document.createElement("h2");
        const div1 = document.getElementById("div1");
        const div2 = document.getElementById("div2");

        previus.setAttribute("class","addButton")
        previus.innerHTML = "<i class='fa-solid fa-backward'></i>";
        next.setAttribute("class","addButton")
        next.innerHTML = "<i class='fa-solid fa-forward'></i>";
        audio.appendChild(source);
        source.setAttribute("src", '/uploads/'+allMusicsParsed[0].url);
        source.setAttribute("type", 'audio/mpeg');

            next.addEventListener("click", function(){
                const indexofItem = allMusicsParsed.findIndex(x => x.url === source.getAttribute("src").replace('/uploads/', ''));
                if(indexofItem +1 === allMusicsParsed.length){
                    source.setAttribute("src", '/uploads/'+allMusicsParsed[0].url);
                    songName.innerHTML = allMusicsParsed[0].name;
                } else {
                    source.setAttribute("src", '/uploads/'+allMusicsParsed[indexofItem + 1].url);
                    songName.innerHTML = allMusicsParsed[indexofItem + 1].name;
                }
                 audio.load();
                 audio.play();
            });

            previus.addEventListener("click", function(){
                const indexofItem = allMusicsParsed.findIndex(x => x.url === source.getAttribute("src").replace('/uploads/', ''));
                if(indexofItem +1 === allMusicsParsed.length){
                    source.setAttribute("src", '/uploads/'+allMusicsParsed[0].url);
                    songName.innerHTML = allMusicsParsed[0].name;
                } else {
                    source.setAttribute("src", '/uploads/'+allMusicsParsed[indexofItem + 1].url);
                    songName.innerHTML = allMusicsParsed[indexofItem + 1].name;
                }
                audio.load();
                audio.play();
            });

        for(let i = 0; i < allMusicsParsed.length; i++){
            const music = allMusicsParsed[i];
            const button = document.createElement("button");

            button.setAttribute("class","addButton")
            button.innerHTML = music.name;
            button.addEventListener("click", function(){
                source.setAttribute("src", '/uploads/'+music.url);
                console.log(source);
                audio.load();
                audio.play();
            });
            div2.appendChild(button);
        }

        div1.appendChild(previus);
        div1.appendChild(next);
        div1.insertBefore(audio, next);
        div1.insertBefore(previus,songName);
    </script>






    <a href="{{ path('front_app_music_group_index') }}">back to list</a>
    {% if is_granted('ROLE_MANAGER') %}
        {% if is_granted('MANAGER_ACCESS', music_group) %}
            <button class="addButton">
                <a href="{{ path('front_app_music_group_edit', {'id': music_group.id}) }}">edit</a>
            </button>
            <button class="addButton">
                <a href="{{ path('front_app_music_new_for_groupmusic' , {'id': music_group.id}) }}">add new Music</a>
            </button>
            {{ include('front/music_group/_delete_form.html.twig') }}
        {% endif %}
    {% endif %}

    {% if is_granted('ROLE_ARTIST', music_group) or is_granted('ROLE_MANAGER', music_group) %}
        {% if is_granted('MANAGER_ACCESS', music_group) or is_granted('MEMBER_ACCES', music_group) %}
            <a href="{{ path('front_app_music_group_calendar', {'id': music_group.id}) }}">voir calendrier</a>
        {% endif %}
    {% endif %}
    <section class="music-group-show">
        <h1>{{ music_group.name }}</h1>
        <h2>Artistes</h2>
        <div class="artist-list">
            {% for artist in music_group.artiste %}
                <div class="artist">
                    <div class="picture">

                    </div>
                    <h4>{{ artist.firstname }}</h4>
                </div>
            {% endfor %}
        </div>
        <h2>Biographie</h2>
        <span>coming soon...</span>
        <div>
            {% if is_granted('ROLE_MANAGER') %}
                {% if is_granted('MANAGER_ACCESS', music_group) %}
                    <a href="{{ path('front_app_music_group_edit', {'id': music_group.id}) }}">Modifier</a>
                {% endif %}
            {% endif %}

            {% if is_granted('ROLE_ARTIST', music_group) or is_granted('ROLE_MANAGER', music_group) %}
                {% if is_granted('MANAGER_ACCESS', music_group) or is_granted('MEMBER_ACCES', music_group) %}
                    <a class="calendar" href="{{ path('front_app_music_group_calendar', {'id': music_group.id}) }}">Voir calendrier</a>
                {% endif %}
            {% endif %}
        </div>
    </section>

{% endblock %}


